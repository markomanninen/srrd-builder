<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRRD-Builder MCP Server - Frontend Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background: #28a745;
        }

        .status-disconnected {
            background: #dc3545;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .tool-grid {
            display: grid;
            gap: 15px;
        }

        .tool-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: left;
        }

        .tool-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .tool-button:active {
            transform: translateY(0);
        }

        .output-panel {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 2px solid #34495e;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† SRRD-Builder MCP Server</h1>
            <p>Neurosymbolic Scientific Research Requirement Document Builder - Frontend Test Interface</p>
        </div>

        <div class="status">
            <span class="status-indicator status-disconnected" id="statusIndicator"></span>
            <span id="statusText">Disconnected from MCP Server</span>
            <div class="controls">
                <button class="btn btn-success" onclick="connect()">Connect to Server</button>
                <button class="btn btn-danger" onclick="disconnect()">Disconnect</button>
                <button class="btn btn-primary" onclick="runDiagnostics()">Run Diagnostics</button>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h3>üß™ Research Planning Tools</h3>
                <div class="tool-grid">
                    <button class="tool-button" onclick="testTool('clarify_research_goals')">
                        üéØ Clarify Research Goals
                    </button>
                    <button class="tool-button" onclick="testTool('suggest_methodology')">
                        üìã Suggest Methodology
                    </button>
                </div>
            </div>

            <div class="panel">
                <h3>‚úÖ Quality Assurance Tools</h3>
                <div class="tool-grid">
                    <button class="tool-button" onclick="testTool('simulate_peer_review')">
                        üë• Simulate Peer Review
                    </button>
                    <button class="tool-button" onclick="testTool('check_quality_gates')">
                        üö™ Check Quality Gates
                    </button>
                </div>
            </div>

            <div class="panel">
                <h3>üìÑ Document Generation</h3>
                <div class="tool-grid">
                    <button class="tool-button" onclick="testTool('generate_latex_document')">
                        üìù Generate LaTeX Document
                    </button>
                    <button class="tool-button" onclick="testTool('format_research_content')">
                        üìê Format Research Content
                    </button>
                    <button class="tool-button" onclick="testTool('generate_bibliography')">
                        üìö Generate Bibliography
                    </button>
                </div>
            </div>

            <div class="panel">
                <h3>üîç Search & Discovery</h3>
                <div class="tool-grid">
                    <button class="tool-button" onclick="testTool('semantic_search')">
                        üîé Semantic Search
                    </button>
                    <button class="tool-button" onclick="testTool('discover_patterns')">
                        üîó Discover Patterns
                    </button>
                    <button class="tool-button" onclick="testTool('extract_key_concepts')">
                        üéØ Extract Key Concepts
                    </button>
                </div>
            </div>

            <div class="panel">
                <h3>üóÑÔ∏è Custom Tool Test</h3>
                <div class="input-group">
                    <label for="customTool">Tool Name:</label>
                    <select id="customTool">
                        <option value="clarify_research_goals">Clarify Research Goals</option>
                        <option value="suggest_methodology">Suggest Methodology</option>
                        <option value="simulate_peer_review">Simulate Peer Review</option>
                        <option value="semantic_search">Semantic Search</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="customParams">Parameters (JSON):</label>
                    <textarea id="customParams" rows="4" placeholder='{"research_area": "quantum physics", "experience_level": "graduate"}'></textarea>
                </div>
                <button class="btn btn-primary" onclick="testCustomTool()">Run Custom Test</button>
            </div>

            <div class="panel">
                <h3>üìä Server Statistics</h3>
                <div id="serverStats">
                    <p>Click "Run Diagnostics" to load server statistics</p>
                </div>
            </div>

            <div class="output-panel panel">
                <h3>üìü Output Console</h3>
                <div id="output" class="output">
üöÄ SRRD-Builder MCP Server Frontend Test Interface Ready

This interface allows you to test the MCP server functionality through a web browser.

Available actions:
‚Ä¢ Connect to the MCP server running on localhost:8765
‚Ä¢ Test individual tools with predefined or custom parameters
‚Ä¢ Monitor server status and performance
‚Ä¢ View real-time output and responses

To get started:
1. Make sure the MCP server is running (srrd-server --with-frontend)
2. Click "Connect to Server" 
3. Test any tool by clicking the buttons above
4. View results in this console

üÜï For ALL 38+ tools dynamically loaded, use index_dynamic.html instead!

Ready for testing! üß™
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="clearOutput()">Clear Output</button>
                    <button class="btn btn-success" onclick="exportResults()">Export Results</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üî¨ SRRD-Builder MCP Server v1.0 - Neurosymbolic Research Document Generation</p>
            <p>Frontend Test Interface ‚Ä¢ Ready for Production ‚Ä¢ 24/24 Tests Passing ‚úÖ</p>
        </div>
    </div>

    <script src="mcp-client.js"></script>
    <script src="test-suite.js"></script>
    <script>
        let mcpClient = null;
        let isConnected = false;
        let testResults = [];

        // Initialize MCP client
        function initializeMCPClient() {
            mcpClient = new MCPClient('ws://localhost:8765');
            
            // Set up callbacks
            mcpClient.onStatusChange = updateStatus;
            mcpClient.onMessage = handleMCPMessage;
        }

        function handleMCPMessage(message) {
            // Handle incoming MCP messages
            if (message.method) {
                log(`üì® Received: ${message.method}`, 'info');
            }
        }

        function updateStatus(connected, message) {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            
            if (connected) {
                indicator.className = 'status-indicator status-connected';
                text.textContent = message || 'Connected to MCP Server';
            } else {
                indicator.className = 'status-indicator status-disconnected';
                text.textContent = message || 'Disconnected from MCP Server';
            }
            isConnected = connected;
        }

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            output.textContent += `\n[${timestamp}] ${prefix} ${message}`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'üöÄ Output cleared. Ready for new tests...\n';
        }

        async function connect() {
            if (!mcpClient) {
                initializeMCPClient();
            }

            try {
                log('Connecting to MCP server on localhost:8765...');
                await mcpClient.connect();
                
                // Test connection by listing tools
                const tools = await mcpClient.listTools();
                log(`Successfully connected! Found ${tools.tools ? tools.tools.length : 0} tools`, 'success');
                
                loadServerStats();
                
            } catch (error) {
                log(`Connection failed: ${error.message}`, 'error');
                log('üí° Make sure the MCP server is running: srrd-server --with-frontend', 'info');
                updateStatus(false, 'Connection failed');
            }
        }

        function disconnect() {
            if (mcpClient) {
                mcpClient.disconnect();
                mcpClient = null;
            }
            updateStatus(false, 'Disconnected by user');
            log('Disconnected from MCP server', 'info');
        }

        async function testTool(toolName) {
            if (!isConnected || !mcpClient) {
                log('Please connect to the server first', 'error');
                return;
            }

            log(`Testing tool: ${toolName}...`);
            
            const testParams = getTestParameters(toolName);
            
            try {
                const response = await mcpClient.callTool(toolName, testParams);
                log(`‚úÖ ${toolName} completed successfully`, 'success');
                log(`Response: ${JSON.stringify(response, null, 2)}`);
                
                testResults.push({
                    tool: toolName,
                    timestamp: new Date().toISOString(),
                    success: true,
                    params: testParams,
                    response: response
                });
                
                updateStats();
                
            } catch (error) {
                log(`‚ùå ${toolName} failed: ${error.message}`, 'error');
                testResults.push({
                    tool: toolName,
                    timestamp: new Date().toISOString(),
                    success: false,
                    error: error.message
                });
                
                updateStats();
            }
        }

        async function testCustomTool() {
            const toolName = document.getElementById('customTool').value;
            const paramsText = document.getElementById('customParams').value;
            
            try {
                const params = paramsText ? JSON.parse(paramsText) : {};
                await testTool(toolName);
                
            } catch (error) {
                log(`‚ùå Invalid JSON parameters: ${error.message}`, 'error');
            }
        }

        function getTestParameters(toolName) {
            const params = {
                'clarify_research_goals': {
                    research_area: 'quantum gravity',
                    initial_goals: 'Develop unified theory',
                    experience_level: 'graduate',
                    domain_specialization: 'theoretical_physics',
                    novel_theory_mode: true
                },
                'suggest_methodology': {
                    research_goals: 'alternative physics theories',
                    domain: 'theoretical_physics',
                    novel_theory_flag: true
                },
                'simulate_peer_review': {
                    document_content: {
                        title: 'Novel Quantum Theory',
                        abstract: 'Revolutionary approach to quantum mechanics',
                        methodology: 'Mathematical analysis',
                        results: 'New theoretical framework'
                    },
                    domain: 'theoretical_physics',
                    review_type: 'comprehensive',
                    novel_theory_mode: true
                },
                'check_quality_gates': {
                    research_content: {
                        title: 'Test Research Paper',
                        abstract: 'Test abstract for validation',
                        methodology: 'Test methodology'
                    },
                    phase: 'publication_readiness'
                },
                'semantic_search': {
                    query: 'quantum mechanics',
                    collection: 'research_docs',
                    limit: 5
                },
                'generate_latex_document': {
                    title: 'Frontend Test Document',
                    author: 'Test Author',
                    abstract: 'Test document generated from frontend',
                    introduction: 'Test introduction',
                    methodology: 'Frontend testing methodology',
                    results: 'Test results',
                    conclusion: 'Frontend test completed'
                },
                'format_research_content': {
                    content: 'This is test content for academic formatting',
                    content_type: 'section',
                    formatting_style: 'academic'
                },
                'generate_bibliography': {
                    references: [
                        {
                            type: 'article',
                            authors: 'Einstein, A.',
                            title: 'Special Relativity Theory',
                            journal: 'Annalen der Physik',
                            year: '1905'
                        }
                    ]
                },
                'discover_patterns': {
                    content: 'quantum mechanics theoretical framework mathematical analysis',
                    pattern_type: 'research_themes',
                    min_frequency: 1
                },
                'extract_key_concepts': {
                    text: 'quantum mechanics theoretical physics computational modeling',
                    max_concepts: 10,
                    concept_types: ['technical_terms', 'theories', 'methods']
                },
                'initialize_project': {
                    name: 'Frontend Test Project',
                    description: 'Project created via frontend interface',
                    domain: 'theoretical_physics'
                }
            };
            return params[toolName] || {};
        }

        async function runDiagnostics() {
            log('Running server diagnostics...');
            
            if (!isConnected || !mcpClient) {
                log('‚ùå Not connected to server', 'error');
                return;
            }
            
            try {
                // Test basic connectivity
                log('Testing WebSocket connection...', 'info');
                const status = mcpClient.getConnectionStatus();
                log(`‚úÖ Connection status: ${status.connected ? 'Connected' : 'Disconnected'}`, 'success');
                
                // Test tool listing
                log('Testing tool discovery...', 'info');
                const tools = await mcpClient.listTools();
                log(`‚úÖ Tool discovery: Found ${tools.tools ? tools.tools.length : 0} tools`, 'success');
                
                // Test a simple tool call
                log('Testing basic tool call...', 'info');
                await testTool('semantic_search');
                
                log('üéâ All diagnostics completed successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Diagnostics failed: ${error.message}`, 'error');
            }
            
            loadServerStats();
        }

        function loadServerStats() {
            const stats = document.getElementById('serverStats');
            const successRate = testResults.length ? 
                Math.round((testResults.filter(r => r.success).length / testResults.length) * 100) : 0;
                
            stats.innerHTML = `
                <div style="display: grid; gap: 10px;">
                    <div><strong>Connection Status:</strong> ${isConnected ? 'Connected ‚úÖ' : 'Disconnected ‚ùå'}</div>
                    <div><strong>Server URL:</strong> ws://localhost:8765</div>
                    <div><strong>Tests Run:</strong> ${testResults.length}</div>
                    <div><strong>Success Rate:</strong> ${successRate}%</div>
                    <div><strong>Successful Tests:</strong> ${testResults.filter(r => r.success).length}</div>
                    <div><strong>Failed Tests:</strong> ${testResults.filter(r => !r.success).length}</div>
                </div>
            `;
        }

        function updateStats() {
            loadServerStats();
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                connectionInfo: mcpClient ? mcpClient.getConnectionStatus() : null,
                testResults: testResults,
                summary: {
                    totalTests: testResults.length,
                    successfulTests: testResults.filter(r => r.success).length,
                    failedTests: testResults.filter(r => !r.success).length,
                    successRate: testResults.length ? 
                        (testResults.filter(r => r.success).length / testResults.length * 100).toFixed(1) + '%' : '0%'
                }
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mcp-frontend-test-results-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('Test results exported successfully!', 'success');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ SRRD-Builder MCP Frontend Test Interface Ready');
            log('');
            log('To get started:');
            log('1. Make sure MCP server is running: srrd-server --with-frontend');
            log('2. Click "Connect to Server"');
            log('3. Test individual tools or run diagnostics');
            log('');
            log('Ready for testing! üß™');
        });
    </script>
</body>
</html>
